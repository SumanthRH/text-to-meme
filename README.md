# <img src="https://user-images.githubusercontent.com/18485647/205524790-25d7b702-3bbc-4920-b586-ea25214ad99f.png" width="30" height="30"/> JESTER: A SOTA Text to Meme Generation Model
<a href ='https://the-jester.streamlit.app/'>Web Demo</a>

In this research project, we propose JESTER, which is a state-of-the-art generative model solution for generating meme captions from user input text. 
Our solution requires the user to provide a setence. Our model then retrieves relevant templates, and also generates meme caption for those templates
in context of the user input and the meme language.

### Methodology
JESTER consists of two parts as shown in the figure below:

1. A meme template retrieval system which use Sentence-BERT finetuned using Contrastive Loss. The model is trained to create meme embeddings in a 
high-dimensional landscape that capture the inherent sarcasm and language context of a meme. The model retrives the templates whose embeddings are 
closest to the user input embedding by cosine similarity scores.

2. A caption generation system that uses GPT-3 to generate creative caption of the meme based on the user input and the meme template context. 
A few manually labeled examples are sent as QA pairs along with the user input as the prompt to GPT-3.

<img width="708" alt="Screen Shot 2022-12-04 at 4 23 23 PM" src="https://user-images.githubusercontent.com/18485647/205525021-dba35931-d3ea-4f30-bd34-2aaa26392343.png">

### Output Samples

In the figure below, we show some sample generated using JESTER. Both the input user prompt and the final generated image are shown.

<img width="697" alt="Screen Shot 2022-12-04 at 4 27 18 PM" src="https://user-images.githubusercontent.com/18485647/205525266-2e8e0b46-660d-4116-a362-8ee77ead9660.png">


### Experimental Results
#### Quantitative

The quantitative results for the model are summarized in the table below. To obtain
a reliable measure for the Random Sample Baseline, we average the MTR over 50 random templates.
In terms of the classification metrics (Top-1, Top-5, Top-10), the RoBERTa model performs the best,
but the SRoBERTa model closely follows the accuracies of the RoBERTa model.

<img width="518" alt="Screen Shot 2022-12-04 at 4 24 30 PM" src="https://user-images.githubusercontent.com/18485647/205525086-23b331ec-b34a-4073-a416-d4459c7419eb.png">

#### Qualitative

To evaluate the effectiveness of our model, we created a survey consisting of 10 different user prompts.
For each prompt, we provide 3 memes using the top 3 meme templates retrieved by SRoBERTa and
the top caption generated by GPT-3. After generating our samples, we sent out the survey asking users
to evaluate the coherence and relevance of each generated meme as well as whether the users liked
them or not (defined in 4). For our survey, we had 30 responses with the following results as outlined
in Table 2. For comparison, we decided to compare against the scores reported in MemeBot.

<img width="396" alt="Screen Shot 2022-12-04 at 4 26 30 PM" src="https://user-images.githubusercontent.com/18485647/205525205-c3b69a60-eb23-4735-bfce-8c6fc77b0004.png">

### About this Repo
#### Data
The folder /data consists of the data that was used to train the SRoBERTa model. More specifically, the file /data/meme_900k_cleaned_data_v2.pkl has the cleaned up and pre-processed data. The code used for preprocessing the data in given in /notebooks/data_cleanup.ipynb.

#### Training
The files /notebooks/transformer_training.ipynb and /notebooks/sentencebert-finetuning.ipynb contain the code for finetuning of a vanilla RoBERTa based
classifier model and the more sophisticated Contrastive Loss based SRoBERTa model respectively.

The final embeddings for all trained models are all stored in /models folder. The actual models themselves are stored in <a href='https://drive.google.com/drive/folders/1LEVAC8kR7-QLMBQsDvwkOVuwpXvp3G4X?usp=share_link'>Google Drive</a>.

#### Demo
The file /notebooks/Final Demo.ipynb is used for a notbeook demo. 

The web demo is hosted on StreamLit Cloud.

#### Utils
The folder /utils consists of .py files critical to the proper functioning of the demo.






